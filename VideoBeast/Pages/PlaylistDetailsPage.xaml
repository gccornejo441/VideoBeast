<Page
    x:Class="VideoBeast.Pages.PlaylistDetailsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:playlists="using:VideoBeast.Playlists"
    mc:Ignorable="d">

	<Page.Resources>
		<Style x:Key="PlaylistItemListViewItemStyle" TargetType="ListViewItem">
			<Setter Property="Padding" Value="0" />
			<Setter Property="Margin" Value="0,2" />
			<Setter Property="HorizontalContentAlignment" Value="Stretch" />
			<Setter Property="Background" Value="Transparent" />
			<Setter Property="BorderThickness" Value="1" />
			<Setter Property="BorderBrush" Value="Transparent" />
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ListViewItem">
						<Grid>
							<Border
                                x:Name="RowRoot"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10">
								<ContentPresenter
                                    HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                    VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                    Content="{TemplateBinding Content}"
                                    ContentTemplate="{TemplateBinding ContentTemplate}" />
							</Border>

							<VisualStateManager.VisualStateGroups>
								<VisualStateGroup x:Name="CommonStates">
									<VisualState x:Name="Normal" />
									<VisualState x:Name="PointerOver">
										<VisualState.Setters>
											<Setter Target="RowRoot.Background" Value="#1AFFFFFF" />
											<Setter Target="RowRoot.BorderBrush" Value="#33FFFFFF" />
										</VisualState.Setters>
									</VisualState>
									<VisualState x:Name="Pressed">
										<VisualState.Setters>
											<Setter Target="RowRoot.Background" Value="#22FFFFFF" />
											<Setter Target="RowRoot.BorderBrush" Value="#55FFFFFF" />
										</VisualState.Setters>
									</VisualState>
									<VisualState x:Name="Disabled">
										<VisualState.Setters>
											<Setter Target="RowRoot.Opacity" Value="0.5" />
										</VisualState.Setters>
									</VisualState>
								</VisualStateGroup>

								<VisualStateGroup x:Name="SelectionStates">
									<VisualState x:Name="Unselected" />
									<VisualState x:Name="Selected">
										<VisualState.Setters>
											<Setter Target="RowRoot.Background" Value="#222222" />
											<Setter Target="RowRoot.BorderBrush" Value="#666666" />
										</VisualState.Setters>
									</VisualState>
									<VisualState x:Name="SelectedPointerOver">
										<VisualState.Setters>
											<Setter Target="RowRoot.Background" Value="#222222" />
											<Setter Target="RowRoot.BorderBrush" Value="#777777" />
										</VisualState.Setters>
									</VisualState>
								</VisualStateGroup>
							</VisualStateManager.VisualStateGroups>
						</Grid>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<MenuFlyout x:Key="ItemFlyout" Opening="ItemFlyout_Opening">
			<MenuFlyoutItem
		              x:Name="FlyoutPlay"
		              Click="Item_Play_Click"
		              Text="Play">
				<MenuFlyoutItem.Icon>
					<SymbolIcon Symbol="Play" />
				</MenuFlyoutItem.Icon>
			</MenuFlyoutItem>

			<MenuFlyoutSeparator />

			<MenuFlyoutSubItem x:Name="AddToPlaylistSubmenu" Text="Add to Playlist">
				<MenuFlyoutSubItem.Icon>
					<SymbolIcon Symbol="Add" />
				</MenuFlyoutSubItem.Icon>
				<!-- Dynamic playlist items will be added here in code-behind -->
				<MenuFlyoutItem Text="+ New Playlist..." Click="Item_AddToNewPlaylist_Click"/>
			</MenuFlyoutSubItem>

			<MenuFlyoutSeparator />

			<MenuFlyoutItem
		              x:Name="FlyoutRelink"
		              Click="Item_Relink_Click"
		              Text="Re-link...">
				<MenuFlyoutItem.Icon>
					<SymbolIcon Symbol="Link" />
				</MenuFlyoutItem.Icon>
			</MenuFlyoutItem>

			<MenuFlyoutItem
		              x:Name="FlyoutShowInExplorer"
		              Click="Item_ShowInExplorer_Click"
		              Text="Show in Explorer">
				<MenuFlyoutItem.Icon>
					<SymbolIcon Symbol="Find" />
				</MenuFlyoutItem.Icon>
			</MenuFlyoutItem>

			<MenuFlyoutItem
		              x:Name="FlyoutCopyPath"
		              Click="Item_CopyPath_Click"
		              Text="Copy Path">
				<MenuFlyoutItem.Icon>
					<SymbolIcon Symbol="Copy" />
				</MenuFlyoutItem.Icon>
			</MenuFlyoutItem>

			<MenuFlyoutSeparator />

			<MenuFlyoutItem
		              x:Name="FlyoutRemove"
		              Click="Item_Remove_Click"
		              Text="Remove from Playlist">
				<MenuFlyoutItem.Icon>
					<SymbolIcon Symbol="Remove" />
				</MenuFlyoutItem.Icon>
			</MenuFlyoutItem>
		</MenuFlyout>
	</Page.Resources>

	<Grid Padding="24">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Header with back button and title -->
		<StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12" Margin="0,0,0,16">
			<Button Content="&#xE72B;" 
                    FontFamily="Segoe MDL2 Assets" 
                    Click="Back_Click"
                    ToolTipService.ToolTip="Back to Playlists"/>
			<TextBlock x:Name="PlaylistTitle" 
                       Style="{StaticResource TitleTextBlockStyle}" 
                       VerticalAlignment="Center"/>
			<TextBlock x:Name="ItemCount" 
                       Style="{StaticResource BodyTextBlockStyle}" 
                       VerticalAlignment="Center" 
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
		</StackPanel>

		<!-- Command Bar -->
		<CommandBar Grid.Row="1" DefaultLabelPosition="Right" Margin="0,0,0,16">
			<AppBarButton Icon="Add" Label="Add Videos" Click="AddVideos_Click"/>
			<AppBarButton Icon="Pictures" Label="Change Cover" Click="ChangeCover_Click"/>
			<AppBarButton Icon="Refresh" Label="Refresh" Click="Refresh_Click"/>
		</CommandBar>

		<!-- Items List -->
		<ListView Grid.Row="2"
                  x:Name="ItemsList"
                  SelectionMode="Single"
                  CanReorderItems="True"
                  AllowDrop="True"
                  ReorderMode="Enabled"
                  DragItemsCompleted="ItemsList_DragItemsCompleted"
                  RightTapped="ItemsList_RightTapped">

			<ListView.ItemContainerStyle>
				<Style BasedOn="{StaticResource PlaylistItemListViewItemStyle}" TargetType="ListViewItem">
					<Setter Property="ContextFlyout" Value="{StaticResource ItemFlyout}" />
				</Style>
			</ListView.ItemContainerStyle>

			<ListView.ItemTemplate>
				<DataTemplate x:DataType="playlists:PlaylistItemModel">
					<Grid Padding="8" ColumnSpacing="12">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="48"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
	
						<!-- Thumbnail -->
						<Border Grid.Column="0"
			                          Width="48" Height="48"
			                          CornerRadius="4"
			                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
							<Image x:Name="ItemThumbnail" Stretch="UniformToFill"/>
						</Border>
	
						<!-- Video info -->
						<StackPanel Grid.Column="1" Spacing="2" VerticalAlignment="Center">
							<TextBlock Text="{x:Bind DisplayName}"
						                              TextTrimming="CharacterEllipsis"/>
							<TextBlock FontSize="12"
						                              Opacity="0.7"
						                              Text="{x:Bind FileName}"
						                              TextTrimming="CharacterEllipsis"/>
						</StackPanel>
	
						<!-- Missing badge -->
						<Border Grid.Column="2"
			                          Background="#CC3333"
			                          CornerRadius="4"
			                          Padding="6,2"
			                          Visibility="{x:Bind IsMissing}">
							<TextBlock Text="Missing"
			                                 FontSize="11"
			                                 FontWeight="SemiBold"/>
						</Border>
					</Grid>
				</DataTemplate>
			</ListView.ItemTemplate>
		</ListView>

		<!-- Empty State -->
		<StackPanel Grid.Row="2" 
                    x:Name="EmptyState"
                    Visibility="Collapsed"
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center">
			<TextBlock Text="No videos in this playlist" Style="{StaticResource SubtitleTextBlockStyle}"/>
			<TextBlock Text="Add videos from the Folder Videos page" 
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                       Margin="0,8,0,0"/>
		</StackPanel>
	</Grid>
</Page>
